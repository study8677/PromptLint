# PromptLint
> **Prompt çš„ CI/CD å·¥å…·ã€‚**
> é€šè¿‡åœ¨æ¨¡å‹é˜¶æ¢¯å’Œä¸åŒæ¸©åº¦èŒƒå›´å†…è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå……æ»¡è‡ªä¿¡åœ°äº¤ä»˜é²æ£’çš„ Promptã€‚

[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**PromptLint** å¸®åŠ©æ‚¨è®¾è®¡ä¸ä»…ä»…åœ¨å•ä¸ªæ¨¡å‹ä¸Šè¡¨ç°è‰¯å¥½ï¼Œè€Œæ˜¯åœ¨å¤šä¸ªæ¨¡å‹ä¸Šéƒ½**é²æ£’ (Robust)** çš„ Promptã€‚å®ƒè¯„ä¼°ä¸€è‡´æ€§ã€ç¨³å®šæ€§å’Œæ ¼å¼ä¾ä»æ€§ï¼Œç¡®ä¿æ‚¨çš„ Prompt å¯ä»¥åœ¨ä¸åŒæ¨¡å‹ä¹‹é—´è¿ç§»ï¼Œå¹¶ä¸”ä¸ä¼šå› ä¸ºé‡‡æ ·å‚æ•°çš„å˜åŒ–è€Œå´©æºƒã€‚

---

## ğŸš€ ä¸ºä»€ä¹ˆé€‰æ‹© PromptLint?

- **ğŸ“‰ æ¨¡å‹é˜¶æ¢¯ (The Model Ladder)**: ä¸è¦åªåœ¨ GPT-4 ä¸Šæµ‹è¯•ã€‚éªŒè¯æ‚¨çš„ Prompt æ˜¯å¦èƒ½åœ¨æ›´ä¾¿å®œ/æ›´å¿«çš„æ¨¡å‹ï¼ˆå¦‚ GPT-3.5, å°å‹å¼€æºæ¨¡å‹ï¼‰ä¸Šå·¥ä½œï¼Œä»è€Œåœ¨ä¸ç‰ºç‰²å¯é æ€§çš„å‰æä¸‹èŠ‚çœæˆæœ¬ã€‚
- **ğŸ§¬ è¯­ä¹‰ä¸€è‡´æ€§ (Semantic Consistency)**: è¶…è¶Šç²¾ç¡®åŒ¹é…ã€‚ä½¿ç”¨åµŒå…¥ç›¸ä¼¼åº¦ (Embedding Similarity) æ¥æ£€æŸ¥ä¸åŒæ¨¡å‹æ˜¯å¦è¡¨è¾¾äº†ç›¸åŒçš„æ„æ€ï¼Œå³ä½¿å®ƒä»¬çš„ç”¨è¯ä¸åŒã€‚
- **ğŸ›¡ çº¦æŸå®ˆå« (Constraint Guards)**: è‡ªåŠ¨å¼ºåˆ¶æ‰§è¡Œ JSON Schemaã€é¡¹ç›®ç¬¦å·è®¡æ•°ã€æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ç­‰ã€‚
- **âš¡ï¸ å¼‚æ­¥ä¸ç¼“å­˜**: ä¸“ä¸ºé€Ÿåº¦è€Œç”Ÿã€‚æ”¯æŒå¹¶å‘è¿è¡Œå¤§å‹æµ‹è¯•å¥—ä»¶ï¼Œå¹¶è‡ªåŠ¨ç¼“å­˜ä»¥èŠ‚çœ API æˆæœ¬ã€‚

## ğŸªœ æ¨¡å‹é˜¶æ¢¯ (The Model Ladder) å“²å­¦

ç”Ÿäº§ç³»ç»Ÿçš„é™åˆ¶å¾€å¾€è¿«ä½¿æˆ‘ä»¬ä½¿ç”¨æ›´å°ã€æ›´å¿«çš„æ¨¡å‹ï¼ˆå¦‚ Llama-3-8B, GPT-3.5ï¼‰ï¼Œè€Œä¸æ˜¯æœ€èªæ˜çš„æ¨¡å‹ï¼ˆå¦‚ GPT-4o, Claude 3.5 Sonnetï¼‰ã€‚

**PromptLint** é€šè¿‡æµ‹è¯•â€œæ¨¡å‹é˜¶æ¢¯â€å°†è¿™ä¸€è¿‡ç¨‹æ ‡å‡†åŒ–ï¼š
1.  **ç¬¬ 1 é˜¶ (Oracle/ç¥è°•)**: å¯ç”¨çš„æœ€èªæ˜æ¨¡å‹ã€‚æˆ‘ä»¬å‡è®¾å…¶è¾“å‡ºæ˜¯â€œåŸºæœ¬äº‹å® (Ground Truth)â€æˆ–ç†æƒ³å“åº”ã€‚
2.  **ç¬¬ 2+ é˜¶ (Candidates/å€™é€‰)**: æˆ‘ä»¬å¸Œæœ›éƒ¨ç½²çš„æ›´å°ã€æ›´ä¾¿å®œçš„æ¨¡å‹ã€‚

æˆ‘ä»¬é€šè¿‡æ£€æŸ¥ç¬¬ 2+ é˜¶æ¨¡å‹æ˜¯å¦åç¦»ç¬¬ 1 é˜¶æ¨¡å‹æ¥è¡¡é‡**ä¸€è‡´æ€§**ã€‚å¦‚æœå°æ¨¡å‹çš„æ„å›¾ä¸å¤§æ¨¡å‹åŒ¹é…ï¼ˆé«˜è¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰ä¸”ç»“æ„ä¸€è‡´ï¼Œåˆ™å¯ä»¥å®‰å…¨éƒ¨ç½²ã€‚

---

## ğŸ›  å·¥ä½œåŸç†

```mermaid
flowchart LR
    A[æµ‹è¯•å¥—ä»¶é…ç½®] --> B(è¿è¡Œå™¨ Runner)
    B --> C{æ¨¡å‹æ±  Provider Pool}
    C -->|GPT-4| D[è¾“å‡º 1]
    C -->|GPT-3.5| E[è¾“å‡º 2]
    C -->|Claude| F[è¾“å‡º 3]
    D & E & F --> G(è¯„ä¼°å™¨ Evaluator)
    G --> H[èšåˆå™¨ Aggregator]
    H --> I[æŠ¥å‘Š Report .md/.json/.html]
```

1.  **å®šä¹‰å¥—ä»¶ (Define a Suite)**: é…ç½®æ‚¨çš„ Promptã€çº¦æŸæ¡ä»¶ä»¥åŠè¦æµ‹è¯•çš„æ¨¡å‹â€œé˜¶æ¢¯â€ã€‚
2.  **è¿è¡Œ (Run)**: PromptLint åœ¨æ‰€æœ‰å®šä¹‰çš„æ¨¡å‹å’Œæ¸©åº¦ï¼ˆä¾‹å¦‚ T=0.0 åˆ° 1.0ï¼‰ä¸Šæ‰§è¡Œ Promptã€‚
3.  **è¯„åˆ† (Score)**: å¯¹è¾“å‡ºè¿›è¡Œ**æ ¼å¼ä¾ä»æ€§**ï¼ˆçœ‹èµ·æ¥å¯¹å—ï¼Ÿï¼‰å’Œ**ä¸€è‡´æ€§**ï¼ˆç¨³å®šå—ï¼Ÿï¼‰è¯„åˆ†ã€‚
4.  **æŠ¥å‘Š (Report)**: è·å–è¯¦ç»†æŠ¥å‘Šï¼Œé«˜äº®æ˜¾ç¤º Prompt åœ¨ä½•å¤„å˜å¾—ä¸ç¨³å®šã€‚

---

## âš¡ï¸ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
pip install -e .
```

### è¿è¡Œæ‚¨çš„ç¬¬ä¸€ä¸ªæµ‹è¯•å¥—ä»¶

1.  è®¾ç½® API Key:
    ```bash
    export OPENAI_API_KEY=sk-...
    ```

2.  è¿è¡Œç¤ºä¾‹å¥—ä»¶:
    ```bash
    promptlint --suite examples/suite.yaml --report report.html --report-format html
    ```

3.  æ‰“å¼€ `report.html` æŸ¥çœ‹æ‚¨çš„é²æ£’æ€§è¯„åˆ†ï¼

---

## ğŸ§© é…ç½®

PromptLint çš„æ ¸å¿ƒæ˜¯ `suite.yaml`ã€‚è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µç¤ºä¾‹ï¼š

```yaml
# 1. å®šä¹‰æä¾›å•† (Providers)
providers:
  - name: "openai"
    kind: "openai_compatible"
    api_key_env: "OPENAI_API_KEY"

# 2. å®šä¹‰æ¨¡å‹é˜¶æ¢¯ (Tiers)
ladder:
  - name: "gpt-4o"
    provider: "openai"
    tier: 1  #ä»¥æ­¤æ¨¡å‹ä¸ºåŸºå‡†
  - name: "gpt-3.5-turbo"
    provider: "openai"
    tier: 2  # æ›´ä¾¿å®œçš„æ›¿ä»£æ–¹æ¡ˆ

# 3. é‡‡æ ·ç­–ç•¥ (Sampling Strategy)
sampling:
  - temperature: 0.0
  - temperature: 0.7  # æµ‹è¯•å™ªéŸ³ä¸‹çš„ç¨³å®šæ€§

# 4. Prompts & çº¦æŸ (Constraints)
prompts:
  - id: "summarize_email"
    text: "Summarize this email in 3 bullet points: {{email_body}}"
    constraints:
      - name: "format_check"
        description: "Must be a list"
        rules:
           type: "count"
           pattern: "^\\s*[-*]"
           min: 3
```

---

## ğŸ“Š æŒ‡æ ‡ (Metrics)

PromptLint å…³æ³¨ç»“æ„å’Œè¯­ä¹‰çš„é²æ£’æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯â€œäº‹å®æ˜¯å¦æ­£ç¡®â€ã€‚

èšåˆä½¿ç”¨åŠ æƒå‡ ä½•å¹³å‡å¹¶åŠ å…¥ç¨³å®šæ€§æƒ©ç½šï¼Œé¿å…å¼±æŒ‡æ ‡è¢«æ©ç›–ã€‚

| æŒ‡æ ‡ (Metric) | æµ‹é‡å†…å®¹ |
| :--- | :--- |
| **çº¦æŸä¾ä»æ€§ (Constraint Adherence)** | è¾“å‡ºæ˜¯å¦æ»¡è¶³æ˜¾å¼è§„åˆ™ (Regex, JSON, é•¿åº¦)? |
| **è·¨æ¨¡å‹ä¸€è‡´æ€§ (Cross-Model Consistency)** | `GPT-4` å’Œ `GPT-3.5` è¯´çš„å†…å®¹æ˜¯å¦ä¸€è‡´? (æ–‡æœ¬ + åµŒå…¥ç›¸ä¼¼åº¦) |
| **æ¸©åº¦ç¨³å®šæ€§ (Temperature Stability)** | å½“æ¸©åº¦å‡é«˜æ—¶ï¼Œè¾“å‡ºæ˜¯å¦å‘ç”Ÿå‰§çƒˆå˜åŒ–? |
| **ä»»åŠ¡å¯¹é½ (Task Alignment)** | è¾“å‡ºæ ¼å¼æ˜¯å¦åŒ¹é… `expected_format` å…ƒæ•°æ®? |
| **æˆåŠŸç‡ (Success Rate)** | æœ‰å¤šå°‘è¿è¡Œæ²¡æœ‰å‡ºç° provider é”™è¯¯? |

---

## ğŸ§ª æµ‹è¯•

æˆ‘ä»¬ç›¸ä¿¡å·¥å…·çš„å¯é æ€§ã€‚è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼ˆå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼‰ä»¥éªŒè¯é€»è¾‘ï¼š

```bash
# ç¡®ä¿å®‰è£…äº†æµ‹è¯•ä¾èµ–
python -m unittest discover tests
```

## è®¸å¯è¯ (License)

MIT
